/*! kirjasto2030 - v0.0.0 - 2015-06-07
* Copyright (c) 2015 ;*/
function displayGraph(a){a=Array.prototype.slice.call(arguments);var b=a[0];if("function"!=typeof b)throw new Error("displayGraph(), no callback provided");a=a.slice(1,a.length),"undefined"==typeof d3?$.getScript("assets/js/d3.min.js",function(){b(a)}):b(a)}function drawTree(a){var b=a[0],c=a[1];if("undefined"==typeof c&&(c="body"),"undefined"==typeof b)throw new Error("drawTree(), no json provided");var d=800,e=d3.layout.tree().size([180,d/4]).separation(function(a,b){return(a.parent===b.parent?1:2)/a.depth}),f=d3.svg.diagonal.radial().projection(function(a){return[a.y,a.x/180*Math.PI]}),g=d3.select(c).append("svg").attr("width",d/2).attr("height",d).append("g").attr("transform","translate(50,"+d/8*3+")");d3.json(b,function(a,b){var c=e.nodes(b),d=e.links(c),h=(g.selectAll(".link").data(d).enter().append("path").attr("class",function(a){return"depth-"+a.source.depth+" link"}).attr("d",f),g.selectAll(".node").data(c).enter().append("g").attr("class",function(a){return"depth-"+a.depth+" node"}).attr("id",function(a){return a.name}).attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"}));h.append("circle").attr("r",4.5),h.append("text").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?"translate(8)":"rotate(180)translate(-8)"}).text(function(a){return a.name})}),d3.select(self.frameElement).style("height",d-150+"px")}function drawANT(){var a=$("main").width(),b=$("body").height();console.log(a,b);var c=["#548ed3","#e95b4d","#00f579","#003399","#ee9911"],d=d3.select("main").append("svg").attr("width",a).attr("height",b).attr("id","ant"),e=d3.layout.force().gravity(.1).distance(function(b){var c=a/4*3;return c*b.value/10}).charge(function(b){var c=a/2;return-c*b.value/10}).linkStrength(.1).friction(.75).size([a,b]);d3.json("data/actors.json",function(a,b){e.nodes(b.nodes).links(b.links).start();var f=d.selectAll(".link").data(b.links).enter().append("line").attr("class","link").style("stroke-width",function(a){return Math.sqrt(a.value)/2}),g=d.selectAll(".node").data(b.nodes).enter().append("g").attr("class","node").call(e.drag);g.append("text").attr("dx","15px").attr("dy","10px").text(function(a){return a.name}),g.append("circle").attr("r",function(a){return parseInt(3+a.value)}).style("fill",function(a){return c[a.group-1]}),e.on("tick",function(){f.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),g.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})})})}var app=$.sammy(function(){var a="partials/",b="stories/",c="page-";$("body").removeClass("loading");var d={etusivu:[!1,["#/teknologia","Teknologia"]],teknologia:[["#/etusivu","Edellinen"],["#/laki","Laki"]],"teknologia-tarinat":[["#/teknologia","Edellinen"],["#/laki","Laki"]],laki:[["#/teknologia","Edellinen"],["#/yhteiskunta","Yhteiskunta"]],"laki-tarinat":[["#/laki","Edellinen"],["#/yhteiskunta","Yhteiskunta"]],yhteiskunta:[["#/laki","Edellinen"]],"yhteiskunta-tarinat":[["#/yhteiskunta","Edellinen"]],raportti:[["#/etusivu","Edellinen"],!1],toimijaverkosto:[["#/etusivu","Edellinen"],!1]},e=function(b,d){var e=(new Date).getTime();$("body").addClass("loading"),$("main").addClass("transition"),setTimeout(function(){$("main").load(a+b+".html",function(){var a=(new Date).getTime()-e-200;a=a>200?0:a,setTimeout(function(){$("body").removeClass("loading"),$("main").removeAttr("class").addClass(c+b),$("#pages a.current").removeClass("current"),$("#pages a[href$='"+b+"'").addClass("current"),"function"==typeof d&&d(),h()},a)})},200),$("body").animate({scrollTop:0},500)},f=function(a){$("main nav").find("a[href$='"+a+"']").addClass("active"),$("#story").load(b+a+".html",function(){g(a),h()})},g=function(a){var b=window.sessionStorage;b&&(b.getItem(a)||b.setItem(a,!0))},h=function(){var a=window.sessionStorage;if(a)for(var b=0;b<a.length;b++)$("a[href$='"+a.key(b)+"']").addClass("read")},i=function(a,b){try{if(a===!1)throw new Error("No button location and label provided, hide button");$(".button-left-bottom").attr("href",a[0]).fadeIn().find("span").html(a[1])}catch(c){$(".button-left-bottom").fadeOut()}try{if(b===!1)throw new Error("No button location and label provided, hide button");$(".button-right-bottom").attr("href",b[0]).fadeIn().find("span").html(b[1])}catch(c){$(".button-right-bottom").fadeOut()}},j=function(){var a=this.params.page,b=this.params.story;d.hasOwnProperty(a)?("undefined"!==b?e(a,function(){f(b)}):e(a),i(d[a][0],d[a][1])):this.redirect("#/etusivu")};this.get("#/:page",j),this.get("#/:page/:story",j),this.get("#/liitteet",function(){e("liitteet"),i(["#/teknologia","Teknologia"],["#/laki","Laki"])}),this.get("",function(){this.redirect("#/etusivu")})});$(function(){app.run(),$("body").on("click",".button-left-bottom, .button-right-bottom",function(){$("body").animate({scrollTop:0},500)})}),$(function(){function a(){c.toggleClass("open")}function b(){c.removeClass("open")}var c=$("#page-navigation"),d=c.find("#pages"),e=$(".button-menu");e.on("click",a),d.on("click","a",b),$(".button-left-bottom, .button-right-bottom").on("click",b)}),$(function(){function a(a,b){try{if(a===!1||"undefined"===b)throw new Error("Hide button");$(".button-left-bottom").attr("href",a).fadeIn().find("span").html(b)}catch(c){$(".button-left-bottom").fadeOut()}}$(document).on("scroll",function(){if($("main").hasClass("page-etusivu")&&$("body").width()>$("#width-30em").width()){var b=$("body").scrollTop()/($("main").height()-$("body").height());$("#intro").css("margin-left",-100*b+"%"),$("#timeline").css("margin-left",-75*b+"%"),$("#timeline-line").css("margin-left",5*(1-b)+"%"),b>.5?($("#timeline").removeClass("collapsed"),$(".timeline-event").addClass("visible"),a("#/etusivu","Etusivu")):($("#timeline").addClass("collapsed"),$(".timeline-event").removeClass("visible"),a(!1))}}),$("main").on("click","#timeline",function(){parseInt($("#timeline").css("margin-left"))<50&&$("body").animate({scrollTop:$(document).height()},1500,function(){a("#/etusivu","Etusivu"),$("#timeline").removeClass("collapsed")})})});